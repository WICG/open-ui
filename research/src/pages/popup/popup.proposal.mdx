---
menu: Proposals
name: Popup (Editor's Draft)
path: /components/popup
pathToResearch: /components/popup.research
---

import '../../styles/spec.css'

**Editors:**

- Mason Freed (Google)
- Melanie Richards (Microsoft)

## HTML Incubation Text: Popup

_Target venue: [HTML Living Standard](https://html.spec.whatwg.org/multipage/)_

<dl class="element">
  <dt>
    <span data-x="concept-element-categories">Categories</span>:
  </dt>
  <dd>
    <span>Flow content</span>.
  </dd>
  <dd>
    <span>Sectioning root</span>.
  </dd>
  <dt>
    <span data-x="concept-element-contexts">Contexts in which this element can be used</span>:
  </dt>
  <dd>
    Where <span>flow content</span> is expected.
  </dd>
  <dt>
    <span data-x="concept-element-content-model">Content model</span>:
  </dt>
  <dd>
    <span>Flow content</span>.
  </dd>
  <dt>
    <span data-x="concept-element-attributes">Content attributes</span>:
  </dt>
  <dd>
    <span>Global attributes</span>
  </dd>
  <dd>
    <code>anchor</code> — Creates an id-reference relationship with another element, which is used
    for both anchor positioning and popup stack management
  </dd>
  <dd>
    <code>delegatesfocus</code> — Whether to move focus to the popup's first focusable element when
    the popup is shown
  </dd>
  <dd>
    <code>initiallyopen</code> — Whether the popup is shown upon document load
  </dd>
  <dt>
    <span data-x="concept-element-accessibility-considerations">Accessibility considerations</span>:
  </dt>
  <dd>
    Pending specification in <a href="https://w3c.github.io/html-aria/">ARIA in HTML</a> and{' '}
    <a href="https://w3c.github.io/html-aam/">HTML-AAM</a>.
  </dd>
</dl>

<p class="todo">
  Add IDL to frontmatter (<a href="https://github.com/openui/open-ui/issues/356">#356</a>)
</p>

A `popup` element represents transient application UI that “pops up” in the
[top layer](https://fullscreen.spec.whatwg.org/#top-layer) of a web document, enabling the user to
perform some task in a timely and immediate fashion. `popup` is similar to the `dialog` element, but
is distinguished by its transient nature (“light dismiss” behaviors) and mutual exclusivity: only
one `popup` element may be rendered at a time, with the exception of nested `popup`s.

<p class="note">
  Examples of popups include: button menus, listboxes used for item selection e.g. comboboxes,
  "teaching" UI, and other progressive-disclosure widgets or content pickers.
</p>

## Showing a `popup` element

A `popup` element and its contents should not be rendered unless:

- The `initiallyopen` attribute is specified
- The `show()` method is invoked
- Or the `popup` element has been invoked through user interaction with an element whose `popup`
  attribute references the `popup` element's ID

This requirement may be implemented indirectly through the style layer. For example,
user agents that
[support the suggested default rendering](https://html.spec.whatwg.org/multipage/infrastructure.html#renderingUA)
implement this requirement using the CSS rules described in the
[Rendering section](https://html.spec.whatwg.org/multipage/rendering.html#rendering).

<h3 id="popup-stack">The popup stack</h3>

This specification introduces a new stacking layer in the document
[top layer](https://www.w3.org/TR/CSS2/zindex.html), called the **popup stack**. Each document has
one popup stack.

The popup stack is an [ordered set](https://infra.spec.whatwg.org/#ordered-set) of elements,
rendered in the order they appear in the set. The last element in the set is rendered last,
and thus appears on top.

Showing or hiding a `popup` element adds or removes the element from the popup stack, respectively.

### The `initiallyopen` attribute

The `initiallyopen` attribute is a
[boolean attribute](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attribute).
When specified, it indicates that the `popup` element should have the `show()` method called upon
document load, such that the user can interact with it.

**Example:**

```html
<popup initiallyopen></popup>
```

If the `initiallyopen` attribute is specified on a `popup` element _subject_, the user agent must
run [showing a `popup` element steps](#showing-popup-steps).

<p class="note">
  As a result of following these run steps: in the event that initiallyopen is specified on multiple
  popups, the last of these popups (with the initiallyopen attribute) in the DOM order will be the
  popup that is rendered upon document load.
</p>

### The `show()` method

The `show()` method renders the `popup` element, such that the user can interact with it.

**Example:**

```html
<popup id="newFeatureUI">
  <p>
    <strong>New!</strong>
    I’m some sort of educational UI…
  </p>
</popup>

<script>
  if (upsellNewFeature) {
    document.getElementById('newFeatureUI').show()
  }
</script>
```

When `show()` is invoked on a `popup` element _subject_, the user agent must
run [showing a `popup` element steps](#showing-popup-steps).

### The `popup` attribute

The `popup` attribute indicates that a related `popup` element should be shown or hidden as the
user interacts with the element where the `popup` attribute is specified. If the attribute is
specified, the attribute's value must be the ID of a `popup` element in the same
[node document](https://dom.spec.whatwg.org/#concept-node-document).

**Example:** Invoking the `button` element in this example should show/hide the `popup` element,
depending on whether or not the `popup` element is currently shown:

```html
<button id="menuButton" popup="menuPopup">Menu</button>
<popup id="menuPopup" role="menu" anchor="menuButton">
  <!-- Markup for menuitems goes here -->
</popup>
```

The `popup` attribute is supported on a subset of
[interactive elements](https://html.spec.whatwg.org/multipage/interactive-elements.html):

- `button`
- `input` in the `button` state
- `input` in the `email`, `number`, `search`, `tel`, `text`, or `url` states

#### Showing/hiding a `popup` element via the `popup` attribute

When an element with the `popup` attribute specified receives a user interaction that should show
the related `popup` element, this element shall be known as the `popup` element's _invoker_.

<p class="note">
  Multiple elements may have a popup attribute that refers to the same popup element. A given popup
  element only has 0 or 1 invokers at a given time. For example, if the popup element was shown
  programmatically, the invoker is null. Otherwise, the element that the user actually interacted
  with to show the popup is its sole invoker.
</p>

If the _invoker_ is a `button` element or an `input` element in the `button` state, and the
_invoker_ is activated; OR the _invoker_ is an input in the `email`, `number`, `search`, `tel`,
`text`, or `url` states and focus is set to the _invoker_, the user agent must run the following
steps:

1. Let _subject_ be the element with the ID referenced by the `popup` attribute specified on the
   _invoker_. If there is no such element, or the _subject_ is not a `popup` element,
   then return.
2. If the `open` IDL attribute on the _subject_ is `true`, run
   [hiding a `popup` element steps](#hiding-current-popups).
3. Otherwise, run [showing a `popup` element steps](#showing-popup-steps).

<p class="question">
  Should we have a way to suppress these steps upon focus, so that the author can enable the popup
  to be shown upon text entry (or some other logic) instead?
</p>

<h3 id="showing-popup-steps">
  Showing a <code>popup</code> element steps
</h3>

Let _candidate subject_ be the new candidate `popup` element to be shown.
If applicable, let _invoker_ be the element whose `popup` attribute specifies the ID of
the _candidate subject_, and which has been activated by the user.
If applicable, let the _anchor element_ be the element whose ID is referenced by the `anchor`
specified on the _candidate subject_.

1. Run the [hiding currently-shown `popup` elements steps](#hiding-current-popups).
2. Add the _subject_ to _subject_'s
   [node document](https://dom.spec.whatwg.org/#concept-node-document)'s [popup stack](#popup-stack).
3. Set the `open` IDL attribute on the _subject_ to `true`.
4. If the `popup` element was shown as a result of a user interaction with an `invoker`, internally
   set the _subject_'s _invoker_ to a pointer to the `invoker` element.
5. Run [focusing steps](#focusing-steps).

## Setting focus when the `popup` element is shown

### The `autofocus` attribute

The [autofocus](https://html.spec.whatwg.org/multipage/interaction.html#the-autofocus-attribute)
content attribute allows the author to indicate that an element is to be focused as soon as the
page is loaded or as soon as the `popup` within which it finds itself is shown.

When specified on the `popup` element, it indicates that when the `popup` element is shown, focus
should move to the `popup` element.

**Example:**

```html
<popup autofocus>
  <p>The popup itself will receive focus.</p>
  <button>A focusable element</p>
</popup>
```

When specified on a descendent of the `popup` element, it indicates that when the `popup` element is
shown, focus should move to the descendent of the `popup` element where `autofocus` is specified.

**Example:**

```html
<popup>
  <p>Text goes here</p>
  <button>Button one</button>
  <button autofocus>Button two</p>
</popup>
```

### The `delegatesfocus` attribute

The `delegatesfocus` content attribute is a
[boolean attribute](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#boolean-attribute).
When specified, it indicates that when the `popup` element is shown, focus should move to the first
focusable descendent of the `popup` element.

**Example:**

```html
<popup delegatesfocus>
  <p>I am not a focusable element.</p>
  <p>Nor am I.</p>
  <button>I will be focused whenever the popup becomes focused.</button>
</popup>
```

<h3 id="focusing-steps">Focusing steps</h3>

When a `popup` is shown, user agents must set the candidate `popup` element to the _focus target_,
then run [get the focusable area
steps](https://html.spec.whatwg.org/multipage/interaction.html#get-the-focusable-area) and
[focusing steps](https://html.spec.whatwg.org/multipage/interaction.html#focusing=steps).

<p class="note">
  Without the precense of the autofocus or delegatefocus attribute, focus remains on the active
  element. This behavior is to enable scenarios where the popup is used in a composite control. For
  example, a combobox where the user expects their focus to stay in the text input instead of moving
  automatically to the listbox popup as and when it appears.
</p>

## Anchoring a `popup` to another element

Many popups have a visual-logical relationship with another element that may not be a part of the
`popup` element's ancestry chain. For example, a `button` may control a `popup` element, and the
`popup` needs to be positioned with respect to this `button`. Or the `popup` element may simply be
used to draw attention to or describe another element. The `anchor` attribute indicates this
relationship. When specified, the attribute's value must be the ID of an element in the same
[node document](https://dom.spec.whatwg.org/#concept-node-document) as the `popup` element.

**Example:**

```html
<button id="myButton">Anchor element</button>
<popup open anchor="myButton">
  <p>
    <strong>New!</strong>
    I’m some sort of educational UI…
  </p>
</popup>
```

The target of the `anchor` attribute participates in determining whether a candiate _popup_ element
is "nested" in a currently-shown `popup`; refer to <a href="#hiding-current-popups">hiding
currently-shown <code>popup</code> elements steps</a>.

<p class="todo">
  Whenever there is a spec to point to for CSS anchored positioning, call out here that the anchor
  attribute is used to help resolve CSS <code>anchor()</code> functions.
</p>

## Hiding a `popup` element

### The `hide()` method

The `hide()` method hides a `popup` element. When `hide()` is invoked, the user agent must run
[hiding a `popup` element steps](#hiding-popup-steps) from the `popup` element _subject_ on which
the method was invoked.

### Light dismissal

"Light dismiss" describes the behavior of a component which dismisses itself automatically when a
user performs an action that implies that they are finished interacting with the component. The
actions that trigger light dismiss are:

- The user presses the escape key.
- A focus change occurs (because of either user interaction or script), where the focus target is
  outside of the contents of the component. This includes the case where the user invokes a
  non-focusable element, which causes focus to jump to the nearest focusable ancestor of that element.
- An OS-level focus change occurs such that the window containing the component no longer has focus.
  For example, the user switches to a different browser tab or switches to a different application.

<p class="todo">
  Land <a href="https://github.com/openui/open-ui/pull/243">#243</a> and link out to this canonical
  definition of light dismissal for consistency (remove inline definition). Layout changes to the
  popup or its anchor element are also ground for light dismissal, figure out how to surface this
  special case.
</p>

When a `popup` element is shown and a light dismiss interaction occurs:

1. If a keypress event for the `ESCAPE` key was fired, the user agent must set the _subject_ to
   the `popup` element and run [hiding a `popup` element steps](#hiding-popup-steps).
2. If a focus change occurs, the user agent must set the _start node_ to the element which received
   the focus event and run [Hiding currently-shown `popup` elements steps](#hiding-current-popups).
3. Otherwise, the user agent must set the _start node_ to null and run [Hiding currently-shown
   `popup` elements steps](#hiding-current-popups).

<h3 id="hiding-current-popups">
  Hiding currently-shown <code>popup</code> elements steps
</h3>

Starting at the top of the [popup stack](#popup-stack):

1. Let _subject_ be the current `popup` element in the [popup stack](#popup-stack).
2. If _candidate subject_ is null, skip to step 6.
3. Otherwise, starting with the _candidate subject_, walk the
   [flat tree](https://drafts.csswg.org/css-scoping/#flattening) to determine whether the _subject_ is
   an ancestor to the _candidate subject_. If the _subject_ is an ancestor, then return.
4. Otherwise, if the _invoker_ is not null, starting with the _invoker_, walk the
   [flat tree](https://drafts.csswg.org/css-scoping/#flattening) to determine whether the _subject_ is
   an ancestor to the _invoker_. If the _subject_ is an ancestor, then return.
5. Otherwise, if the _anchor element_ is not null, starting with the _anchor element_, walk the
   [flat tree](https://drafts.csswg.org/css-scoping/#flattening) to determine whether the _subject_ is
   an ancestor to the _anchor element_. If the _subject_ is an ancestor, then return.
6. If _start node_ is not null, starting with the _start node_, walk the
   [flat tree](https://drafts.csswg.org/css-scoping/#flattening) to determine whether the _subject_ is
   the _start node_ or an ancestor to the _start node_. If either condition is met, then return.
7. Otherwise, for this _subject_, run the
   [hiding a `popup` element steps](#hiding-popup-steps). Repeat for the next `popup` element in
   the [popup stack](#popup-stack).

<h3 id="hiding-popup-steps">
  Hiding a <code>popup</code> element steps
</h3>

The hiding steps for a `popup` element _subject_ are as follows:

1. Remove the _subject_ from the
   [node document](https://dom.spec.whatwg.org/#concept-node-document)'s
   [top layer](https://fullscreen.spec.whatwg.org/#top-layer).
2. Set the `open` IDL attribute on the _subject_ to `false`.
3. If applicable, empty the _subject_'s _invoker_.
4. [Queue an element task](https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task)
   on the [user interaction task source](https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source)
   given the _subject_ element to [fire a non-cancelable event](https://dom.spec.whatwg.org/#concept-event-fire)
   named `hide` at _subject_.

---

## HTML Incubation Text: User Interaction > Focus > Processing Model

<p class="note">
  The following text to be inserted into the
  <a href="https://html.spec.whatwg.org/multipage/interaction.html#focus-processing-model)">
    get the focusable area steps
  </a>.
</p>

**If _focus target_ is a `popup` element**

1. If the `delegatesfocus` attribute is specified on _focus target_, return the first focusable
   descendent element of _focus target_, in
   [tree order](https://dom.spec.whatwg.org/#concept-tree-order), that is not inert.
2. If there is no such descendent, but `delegatesfocus` is specified, return the _focus target_.
3. Otherwise, if the `autofocus` attribute is specified on _focus target_, return the _focus target_.
4. Otherwise, if the `autofocus` attribute is specified on a descendent element of _focus target_,
   return the first such descendent element of _focus target_, in
   [tree order](https://dom.spec.whatwg.org/#concept-tree-order), that is not inert.
5. Otherwise, return.
